<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>êµì‚¬ ì¡°êµ AI</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;400;600;900&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f5f0e8;
  --surface: #ffffff;
  --surface2: #fdf8f2;
  --border: rgba(139,69,19,0.13);
  --primary: #8B4513;
  --primary-dim: rgba(139,69,19,0.09);
  --accent: #5a7a4a;
  --accent-dim: rgba(90,122,74,0.1);
  --gold: #c9963a;
  --text: #1a1410;
  --text-dim: rgba(26,20,16,0.55);
  --text-muted: rgba(26,20,16,0.35);
  --red: #c0392b;
  --shadow: 0 4px 24px rgba(139,69,19,0.12);
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Noto Sans KR', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  background-image: 
    repeating-linear-gradient(0deg, transparent, transparent 31px, rgba(139,69,19,0.04) 31px, rgba(139,69,19,0.04) 32px);
}

/* Header */
header {
  background: #1a1410;
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  padding: 0 32px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 100;
}

.logo {
  font-family: 'Noto Serif KR', serif;
  font-weight: 900;
  font-size: 1.15rem;
  letter-spacing: -0.02em;
  display: flex;
  align-items: center;
  gap: 10px;
}

.logo-icon {
  width: 32px; height: 32px;
  background: linear-gradient(135deg, var(--primary), var(--accent));
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem;
}

.logo-text { color: #f5f0e8; }
.logo-text span { color: var(--gold); }

.header-badge {
  font-size: 0.72rem;
  background: rgba(201,150,58,0.2);
  color: var(--gold);
  padding: 4px 10px;
  border-radius: 20px;
  border: 1px solid rgba(201,150,58,0.3);
  letter-spacing: 0.05em;
}

/* API Bar */
.api-bar {
  background: rgba(201,150,58,0.07);
  border-bottom: 1px solid rgba(201,150,58,0.2);
  padding: 10px 32px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.api-bar label {
  font-size: 0.78rem;
  color: var(--gold);
  font-weight: 600;
  white-space: nowrap;
  text-transform: none;
  letter-spacing: 0;
}

.api-bar input {
  flex: 1;
  max-width: 400px;
  padding: 8px 12px;
  background: white;
  border: 1px solid rgba(201,150,58,0.25);
  border-radius: 6px;
  color: var(--text);
  font-family: monospace;
  font-size: 0.8rem;
  outline: none;
}

.api-bar input:focus { border-color: var(--gold); }

.btn-api-save {
  padding: 7px 16px;
  background: rgba(246,216,96,0.15);
  border: 1px solid rgba(246,216,96,0.3);
  color: var(--gold);
  border-radius: 6px;
  font-size: 0.78rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.btn-api-save:hover { background: rgba(246,216,96,0.25); }

.btn-api-del {
  padding: 7px 14px;
  background: transparent;
  border: 1px solid rgba(226,232,240,0.1);
  color: var(--text-muted);
  border-radius: 6px;
  font-size: 0.78rem;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-api-del:hover { border-color: var(--red); color: var(--red); }

.api-status {
  font-size: 0.75rem;
  display: flex;
  align-items: center;
  gap: 5px;
}

.api-status.ok { color: var(--accent); }
.api-status.no { color: var(--text-muted); }

/* Layout */
.layout {
  display: grid;
  grid-template-columns: 220px 1fr;
  min-height: calc(100vh - 100px);
}

/* Sidebar nav */
.sidenav {
  background: #ffffff;
  border-right: 1px solid var(--border);
  padding: 24px 12px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  box-shadow: 2px 0 8px rgba(139,69,19,0.05);
}

.nav-section-label {
  font-size: 0.68rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  padding: 8px 12px 4px;
  margin-top: 8px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.15s;
  color: var(--text-dim);
  font-size: 0.88rem;
  border: 1px solid transparent;
}

.nav-item:hover { background: rgba(139,69,19,0.06); color: var(--primary); }

.nav-item.active {
  background: var(--primary-dim);
  color: var(--primary);
  border-color: rgba(139,69,19,0.18);
  font-weight: 600;
}

.nav-icon { font-size: 1rem; width: 20px; text-align: center; }

/* Main content */
.content {
  padding: 32px;
  overflow-y: auto;
}

/* Panel */
.panel { display: none; animation: fadeUp 0.25s ease; }
.panel.active { display: block; }

@keyframes fadeUp {
  from { opacity:0; transform: translateY(6px); }
  to { opacity:1; transform: translateY(0); }
}

.panel-header { margin-bottom: 28px; }

.panel-title {
  font-family: 'Noto Serif KR', serif;
  font-size: 1.6rem;
  font-weight: 900;
  line-height: 1.2;
  margin-bottom: 6px;
}

.panel-title .accent { color: var(--primary); }
.panel-title .accent-green { color: var(--accent); }
.panel-title .accent-gold { color: var(--gold); }

.panel-desc {
  font-size: 0.85rem;
  color: var(--text-dim);
  line-height: 1.6;
}

/* Form */
.form-group { margin-bottom: 18px; }

label {
  display: block;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--text-dim);
  margin-bottom: 7px;
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

input[type=text], input[type=date], select, textarea {
  width: 100%;
  padding: 11px 14px;
  background: white;
  border: 1.5px solid rgba(139,69,19,0.18);
  border-radius: 8px;
  color: var(--text);
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.88rem;
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input[type=text]:focus, select:focus, textarea:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(139,69,19,0.08);
}

textarea { min-height: 110px; resize: vertical; line-height: 1.7; }

select option { background: white; color: var(--text); }

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}

.form-row-3 {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 14px;
}

/* Chips */
.chip-group { display: flex; flex-wrap: wrap; gap: 7px; margin-top: 7px; }

.chip {
  padding: 5px 13px;
  border: 1.5px solid rgba(139,69,19,0.2);
  border-radius: 20px;
  font-size: 0.78rem;
  cursor: pointer;
  transition: all 0.15s;
  color: var(--text-dim);
  background: white;
}

.chip:hover { border-color: var(--primary); color: var(--primary); }
.chip.selected { background: var(--primary-dim); border-color: rgba(139,69,19,0.3); color: var(--primary); font-weight: 600; }
.chip.green.selected { background: rgba(90,122,74,0.1); border-color: rgba(90,122,74,0.35); color: var(--accent); }

/* Buttons */
.btn-primary {
  background: #1a1410;
  color: #f5f0e8;
  border: none;
  padding: 12px 28px;
  border-radius: 8px;
  font-family: 'Noto Serif KR', serif;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 7px;
  letter-spacing: -0.01em;
}

.btn-primary:hover { background: var(--primary); transform: translateY(-1px); box-shadow: 0 4px 16px rgba(139,69,19,0.25); }
.btn-primary:active { transform: translateY(0); }
.btn-primary.green { background: var(--accent); color: white; }
.btn-primary.green:hover { background: #4a6a3a; box-shadow: 0 4px 16px rgba(90,122,74,0.3); }
.btn-primary.gold { background: var(--gold); color: white; }
.btn-primary.gold:hover { background: #a87a28; }

.btn-secondary {
  padding: 9px 16px;
  background: white;
  border: 1.5px solid rgba(139,69,19,0.2);
  border-radius: 7px;
  color: var(--text-dim);
  font-size: 0.82rem;
  cursor: pointer;
  transition: all 0.15s;
  font-family: 'Noto Sans KR', sans-serif;
}

.btn-secondary:hover { border-color: var(--primary); color: var(--primary); background: var(--primary-dim); }

/* Result */
.result-box {
  margin-top: 24px;
  background: white;
  border: 1.5px solid rgba(139,69,19,0.15);
  border-radius: 12px;
  overflow: hidden;
}

.result-header {
  background: #1a1410;
  padding: 12px 18px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--border);
}

.result-title {
  font-size: 0.78rem;
  color: var(--gold);
  font-weight: 600;
  letter-spacing: 0.04em;
  text-transform: uppercase;
}

.copy-btn {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  color: rgba(245,240,232,0.7);
  padding: 4px 12px;
  border-radius: 4px;
  font-size: 0.72rem;
  cursor: pointer;
  transition: all 0.15s;
}

.copy-btn:hover { background: rgba(255,255,255,0.2); color: white; }

.result-content {
  padding: 22px;
  font-size: 0.9rem;
  line-height: 1.9;
  color: var(--text);
  white-space: pre-wrap;
  min-height: 80px;
}

/* Loading */
.loading-wrap { padding: 40px; text-align: center; }
.loading-dots { display: inline-flex; gap: 5px; }
.loading-dots span {
  width: 7px; height: 7px;
  background: var(--primary);
  border-radius: 50%;
  animation: ldot 1.2s infinite;
}
.loading-dots span:nth-child(2) { animation-delay: 0.2s; }
.loading-dots span:nth-child(3) { animation-delay: 0.4s; }
@keyframes ldot {
  0%,80%,100% { transform: scale(0.5); opacity: 0.3; }
  40% { transform: scale(1); opacity: 1; }
}
.loading-label { margin-top: 10px; font-size: 0.8rem; color: var(--text-muted); }

/* Cards grid */
.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 28px;
}

.info-card {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 16px;
}

.info-card-label {
  font-size: 0.72rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 6px;
}

.info-card-value {
  font-size: 0.95rem;
  color: var(--text);
  font-weight: 500;
}

/* í•™ìƒ ìƒë‹´ */
.counsel-layout {
  display: grid;
  grid-template-columns: 250px 1fr;
  gap: 20px;
  min-height: 500px;
}

.student-sidebar {
  background: white;
  border: 1.5px solid rgba(139,69,19,0.15);
  border-radius: 12px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.sidebar-header {
  background: #1a1410;
  padding: 12px 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--border);
}

.sidebar-title {
  font-size: 0.78rem;
  color: var(--gold);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

.btn-add-student {
  width: 24px; height: 24px;
  background: rgba(201,150,58,0.2);
  border: 1px solid rgba(201,150,58,0.4);
  color: var(--gold);
  border-radius: 50%;
  font-size: 1rem;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s;
  line-height: 1;
}

.btn-add-student:hover { background: var(--gold); color: white; }

.student-search-wrap { padding: 10px; border-bottom: 1px solid var(--border); }
.student-search-wrap input { padding: 7px 11px; font-size: 0.8rem; }

.student-list { flex: 1; overflow-y: auto; padding: 8px; }

.student-card {
  padding: 9px 11px;
  border-radius: 7px;
  cursor: pointer;
  transition: all 0.15s;
  margin-bottom: 3px;
  border: 1px solid transparent;
}

.student-card:hover { background: rgba(99,179,237,0.06); }
.student-card.active { background: var(--primary-dim); border-color: rgba(99,179,237,0.25); }

.student-card-name {
  font-size: 0.88rem;
  font-weight: 600;
  color: var(--text);
}

.student-card-meta { font-size: 0.73rem; color: var(--text-muted); margin-top: 2px; }

.student-badge {
  display: inline-block;
  background: var(--accent-dim);
  color: var(--accent);
  font-size: 0.62rem;
  padding: 1px 6px;
  border-radius: 10px;
  margin-left: 5px;
}

.counsel-detail { display: flex; flex-direction: column; gap: 16px; }

.detail-card {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
}

.detail-card-header {
  background: rgba(0,0,0,0.25);
  padding: 11px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.detail-card-title {
  font-size: 0.82rem;
  color: var(--accent);
  font-weight: 600;
}

.detail-card-body { padding: 16px; }

.record-list { display: flex; flex-direction: column; gap: 10px; }

.record-item {
  border: 1.5px solid rgba(139,69,19,0.1);
  border-radius: 8px;
  padding: 12px 14px;
  background: #fdf8f2;
  position: relative;
}

.record-item-date {
  font-size: 0.72rem;
  color: var(--text-muted);
  margin-bottom: 5px;
  display: flex;
  align-items: center;
  gap: 7px;
}

.record-type-badge {
  display: inline-block;
  padding: 1px 7px;
  border-radius: 10px;
  font-size: 0.68rem;
  font-weight: 600;
}

.badge-student { background: var(--primary-dim); color: var(--primary); }
.badge-parent { background: rgba(201,150,58,0.12); color: var(--gold); }

.record-item-content { font-size: 0.85rem; line-height: 1.7; color: var(--text); white-space: pre-wrap; }

.record-delete {
  position: absolute;
  top: 8px; right: 8px;
  background: none;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 1rem;
  transition: color 0.15s;
}

.record-delete:hover { color: var(--red); }

/* Modal */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  backdrop-filter: blur(4px);
}

.modal {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  width: 100%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: var(--shadow);
  animation: modalIn 0.2s ease;
}

@keyframes modalIn {
  from { opacity:0; transform: scale(0.96) translateY(8px); }
  to { opacity:1; transform: scale(1) translateY(0); }
}

.modal-header {
  background: rgba(0,0,0,0.3);
  padding: 18px 22px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-radius: 16px 16px 0 0;
}

.modal-title {
  font-family: 'Noto Serif KR', serif;
  font-size: 1rem;
  font-weight: 700;
  color: var(--text);
}

.modal-close {
  background: none;
  border: none;
  color: var(--text-muted);
  font-size: 1.3rem;
  cursor: pointer;
  transition: color 0.15s;
  line-height: 1;
}

.modal-close:hover { color: var(--text); }
.modal-body { padding: 22px; }
.modal-footer { padding: 0 22px 22px; display: flex; gap: 10px; justify-content: flex-end; }

/* Empty state */
.empty-state {
  text-align: center;
  padding: 50px 20px;
  color: var(--text-muted);
}

.empty-state .ei { font-size: 2.2rem; margin-bottom: 10px; }
.empty-state p { font-size: 0.85rem; line-height: 1.6; }

/* Divider */
.divider {
  border: none;
  border-top: 1px solid var(--border);
  margin: 24px 0;
}

/* Reading specific */
.book-cover {
  width: 100%;
  height: 120px;
  background: linear-gradient(135deg, var(--primary-dim), var(--accent-dim));
  border: 1px solid var(--border);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
  margin-bottom: 16px;
}

/* Responsive */
@media (max-width: 768px) {
  .layout { grid-template-columns: 1fr; }
  .sidenav { flex-direction: row; overflow-x: auto; padding: 8px; gap: 4px; border-right: none; border-bottom: 1px solid var(--border); }
  .nav-section-label { display: none; }
  .nav-item { white-space: nowrap; padding: 8px 12px; }
  .content { padding: 20px 16px; }
  .form-row, .form-row-3 { grid-template-columns: 1fr; }
  .counsel-layout { grid-template-columns: 1fr; }
  .api-bar { flex-wrap: wrap; }
}
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-icon">ğŸ“š</div>
    <div class="logo-text">êµì‚¬ <span>ì¡°êµ AI</span></div>
  </div>
  <div class="header-badge">TEACHING ASSISTANT</div>
</header>

<div class="api-bar">
  <label>ğŸ”‘ API í‚¤</label>
  <input type="password" id="apiKey" placeholder="sk-ant-..." />
  <button class="btn-api-save" onclick="saveKey()">ì €ì¥</button>
  <button class="btn-api-del" onclick="deleteKey()">ì‚­ì œ</button>
  <span class="api-status no" id="api-status">â— ë¯¸ì„¤ì •</span>
</div>

<div class="layout">
  <!-- ì‚¬ì´ë“œ ë„¤ë¹„ -->
  <nav class="sidenav">
    <div class="nav-section-label">ìˆ˜ì—…</div>
    <div class="nav-item active" onclick="showPanel('lesson', this)">
      <span class="nav-icon">ğŸ“</span>ìˆ˜ì—… ìë£Œ ìƒì„±
    </div>
    <div class="nav-item" onclick="showPanel('reading', this)">
      <span class="nav-icon">ğŸ“–</span>í•™ìƒ ë…ì„œ ì§€ë„
    </div>
    <div class="nav-item" onclick="showPanel('writing', this)">
      <span class="nav-icon">âœï¸</span>ê¸€ì“°ê¸° ì§€ë„
    </div>
    <div class="nav-item" onclick="showPanel('math', this)">
      <span class="nav-icon">ğŸ”¢</span>ìˆ˜í•™ í•™ìŠµ
    </div>
    <div class="nav-section-label">ìƒë‹´</div>
    <div class="nav-item" onclick="showPanel('counsel', this)">
      <span class="nav-icon">ğŸ«‚</span>í•™ìƒ ìƒë‹´ ê´€ë¦¬
    </div>
    <div class="nav-item" onclick="showPanel('grade', this)">
      <span class="nav-icon">âœ…</span>ì±„ì Â·í”¼ë“œë°±
    </div>
  </nav>

  <!-- ì½˜í…ì¸  ì˜ì—­ -->
  <main class="content">

    <!-- â‘  ìˆ˜ì—… ìë£Œ ìƒì„± -->
    <div id="panel-lesson" class="panel active">
      <div class="panel-header">
        <div class="panel-title">ìˆ˜ì—… ìë£Œ <span class="accent">ìë™ ìƒì„±</span></div>
        <div class="panel-desc">ê³¼ëª©Â·í•™ë…„Â·ë‹¨ì› ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ ìˆ˜ì—… ê°œìš”, í•™ìŠµì§€, í€´ì¦ˆë¥¼ ì¦‰ì‹œ ìƒì„±í•©ë‹ˆë‹¤.</div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ê³¼ëª©</label>
          <input type="text" id="l-subject" placeholder="êµ­ì–´, ìˆ˜í•™, ì˜ì–´, ì‚¬íšŒ..." />
        </div>
        <div class="form-group">
          <label>í•™ë…„</label>
          <select id="l-grade">
            <option value="">ì„ íƒ</option>
            <option>ì´ˆë“± 1~2í•™ë…„</option><option>ì´ˆë“± 3~4í•™ë…„</option><option>ì´ˆë“± 5~6í•™ë…„</option>
            <option>ì¤‘í•™êµ 1í•™ë…„</option><option>ì¤‘í•™êµ 2í•™ë…„</option><option>ì¤‘í•™êµ 3í•™ë…„</option>
            <option>ê³ ë“±í•™êµ 1í•™ë…„</option><option>ê³ ë“±í•™êµ 2í•™ë…„</option><option>ê³ ë“±í•™êµ 3í•™ë…„</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>ë‹¨ì› / ì£¼ì œ</label>
        <input type="text" id="l-topic" placeholder="ì˜ˆ: ì¡°ì„  ê±´êµ­, ë¶„ìˆ˜ì˜ ê³±ì…ˆ, ì‹œì˜ ìš´ìœ¨..." />
      </div>
      <div class="form-group">
        <label>ìƒì„±í•  ìë£Œ</label>
        <div class="chip-group" id="material-chips">
          <div class="chip selected" onclick="toggleChip(this)">ìˆ˜ì—… ê°œìš”</div>
          <div class="chip" onclick="toggleChip(this)">í•™ìŠµì§€ (ë¹ˆì¹¸ì±„ìš°ê¸°)</div>
          <div class="chip" onclick="toggleChip(this)">í€´ì¦ˆ 5ë¬¸í•­</div>
          <div class="chip" onclick="toggleChip(this)">í† ë¡  ì§ˆë¬¸</div>
          <div class="chip" onclick="toggleChip(this)">í•µì‹¬ ìš©ì–´ ì •ë¦¬</div>
          <div class="chip" onclick="toggleChip(this)">ìˆ˜í–‰í‰ê°€ ê¸°ì¤€í‘œ</div>
        </div>
      </div>
      <button class="btn-primary" onclick="runLesson()">âœ¨ ìë£Œ ìƒì„±</button>
      <div class="result-box" id="lesson-result" style="display:none">
        <div class="result-header">
          <span class="result-title">ìƒì„±ëœ ìˆ˜ì—… ìë£Œ</span>
          <button class="copy-btn" onclick="copyResult('lesson-content')">ë³µì‚¬</button>
        </div>
        <div class="result-content" id="lesson-content"></div>
      </div>
    </div>

    <!-- â‘¡ í•™ìƒ ë…ì„œ ì§€ë„ -->
    <div id="panel-reading" class="panel">
      <div class="panel-header">
        <div class="panel-title">í•™ìƒ <span class="accent-green">ë…ì„œ ì§€ë„</span></div>
        <div class="panel-desc">ì±… ì •ë³´ì™€ í•™ë…„ì„ ì…ë ¥í•˜ë©´ ë…ì„œ í™œë™ì§€, í† ë¡  ì§ˆë¬¸, ë…í›„ê° ê°€ì´ë“œë¥¼ ë§Œë“¤ì–´ ë“œë¦½ë‹ˆë‹¤.</div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ì±… ì œëª©</label>
          <input type="text" id="rd-title" placeholder="ì˜ˆ: ì–´ë¦°ì™•ì, í™ê¸¸ë™ì „..." />
        </div>
        <div class="form-group">
          <label>ì €ì (ì„ íƒ)</label>
          <input type="text" id="rd-author" placeholder="ì˜ˆ: ìƒí…ì¥í˜ë¦¬" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ëŒ€ìƒ í•™ë…„</label>
          <select id="rd-grade">
            <option value="">ì„ íƒ</option>
            <option>ì´ˆë“± ì €í•™ë…„ (1~2í•™ë…„)</option><option>ì´ˆë“± ì¤‘í•™ë…„ (3~4í•™ë…„)</option>
            <option>ì´ˆë“± ê³ í•™ë…„ (5~6í•™ë…„)</option><option>ì¤‘í•™ìƒ</option><option>ê³ ë“±í•™ìƒ</option>
          </select>
        </div>
        <div class="form-group">
          <label>ë…ì„œ í™œë™ ëª©ì </label>
          <select id="rd-purpose">
            <option>ì¢…í•©ì  ì´í•´</option><option>ì–´íœ˜ë ¥ í–¥ìƒ</option>
            <option>ì°½ì˜ì  ê¸€ì“°ê¸° ì—°ê³„</option><option>í† ë¡  ìˆ˜ì—… ì¤€ë¹„</option>
            <option>ë…í›„ê° ì“°ê¸°</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>ìƒì„±í•  ìë£Œ</label>
        <div class="chip-group" id="reading-chips">
          <div class="chip green selected" onclick="toggleChip(this)">ë…ì„œ í™œë™ì§€</div>
          <div class="chip green" onclick="toggleChip(this)">í† ë¡  ì§ˆë¬¸ 5ê°œ</div>
          <div class="chip green" onclick="toggleChip(this)">ë…í›„ê° ì‘ì„± ê°€ì´ë“œ</div>
          <div class="chip green" onclick="toggleChip(this)">ì–´íœ˜ í•™ìŠµ í™œë™</div>
          <div class="chip green" onclick="toggleChip(this)">ì¤„ê±°ë¦¬ ìš”ì•½ í‹€</div>
          <div class="chip green" onclick="toggleChip(this)">ì‹¬í™” ì‚¬ê³  ì§ˆë¬¸</div>
        </div>
      </div>
      <div class="form-group">
        <label>ì¶”ê°€ ë©”ëª¨ (ì„ íƒ)</label>
        <textarea id="rd-memo" placeholder="íŠ¹ë³„íˆ ê°•ì¡°í•˜ê³  ì‹¶ì€ ì£¼ì œ, ì—°ê³„ êµê³¼, ìˆ˜ì—… ë°©ì‹ ë“±..." style="min-height:70px"></textarea>
      </div>
      <button class="btn-primary green" onclick="runReading()">ğŸ“– ë…ì„œ ìë£Œ ìƒì„±</button>
      <div class="result-box" id="reading-result" style="display:none">
        <div class="result-header">
          <span class="result-title" style="color:var(--accent)">ë…ì„œ ì§€ë„ ìë£Œ</span>
          <button class="copy-btn" style="color:var(--accent);border-color:rgba(104,211,145,0.3);background:rgba(104,211,145,0.1)" onclick="copyResult('reading-content')">ë³µì‚¬</button>
        </div>
        <div class="result-content" id="reading-content"></div>
      </div>
    </div>

    <!-- â‘¢ ê¸€ì“°ê¸° ì§€ë„ -->
    <div id="panel-writing" class="panel">
      <div class="panel-header">
        <div class="panel-title">ê¸€ì“°ê¸° <span class="accent">ì§€ë„ ë„ìš°ë¯¸</span></div>
        <div class="panel-desc">ê¸€ì“°ê¸° ì£¼ì œì™€ ìœ í˜•ì„ ì„¤ì •í•˜ë©´ ì§€ë„ ìë£Œ, ì˜ˆì‹œë¬¸, ì±„ì  ê¸°ì¤€ì„ ë§Œë“¤ì–´ ë“œë¦½ë‹ˆë‹¤.</div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ê¸€ì“°ê¸° ìœ í˜•</label>
          <select id="wr-type">
            <option>ì„¤ëª…ë¬¸</option><option>ë…¼ì„¤ë¬¸</option><option>ë…í›„ê°</option>
            <option>ì¼ê¸°</option><option>í¸ì§€</option><option>ì‹œ</option>
            <option>ê¸°í–‰ë¬¸</option><option>ìê¸°ì†Œê°œì„œ</option><option>ë³´ê³ ì„œ</option>
          </select>
        </div>
        <div class="form-group">
          <label>ëŒ€ìƒ í•™ë…„</label>
          <select id="wr-grade">
            <option value="">ì„ íƒ</option>
            <option>ì´ˆë“± 1~2í•™ë…„</option><option>ì´ˆë“± 3~4í•™ë…„</option><option>ì´ˆë“± 5~6í•™ë…„</option>
            <option>ì¤‘í•™ìƒ</option><option>ê³ ë“±í•™ìƒ</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>ê¸€ì“°ê¸° ì£¼ì œ / ì†Œì¬</label>
        <input type="text" id="wr-topic" placeholder="ì˜ˆ: í™˜ê²½ ë³´í˜¸, ë‚˜ì˜ ê¿ˆ, ê°€ì¡±ì˜ ì†Œì¤‘í•¨..." />
      </div>
      <div class="form-group">
        <label>ìƒì„±í•  ìë£Œ</label>
        <div class="chip-group" id="writing-chips">
          <div class="chip selected" onclick="toggleChip(this)">ê¸€ì“°ê¸° ì§€ë„ì•ˆ</div>
          <div class="chip" onclick="toggleChip(this)">ê°œìš” ì‘ì„± í‹€</div>
          <div class="chip selected" onclick="toggleChip(this)">ì˜ˆì‹œë¬¸ (ìš°ìˆ˜ ìˆ˜ì¤€)</div>
          <div class="chip" onclick="toggleChip(this)">ì±„ì  ë£¨ë¸Œë¦­</div>
          <div class="chip" onclick="toggleChip(this)">ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜ ëª©ë¡</div>
          <div class="chip" onclick="toggleChip(this)">í‘œí˜„ ì–´íœ˜ ëª©ë¡</div>
        </div>
      </div>
      <div class="form-group">
        <label>í•™ìƒ ê¸€ ì²¨ì‚­ (ìˆìœ¼ë©´ ì…ë ¥)</label>
        <textarea id="wr-student-text" placeholder="ì²¨ì‚­ì´ í•„ìš”í•œ í•™ìƒ ê¸€ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. ì—†ìœ¼ë©´ ë¹„ì›Œë‘ì„¸ìš”..." style="min-height:90px"></textarea>
      </div>
      <button class="btn-primary" onclick="runWriting()">âœï¸ ê¸€ì“°ê¸° ìë£Œ ìƒì„±</button>
      <div class="result-box" id="writing-result" style="display:none">
        <div class="result-header">
          <span class="result-title">ê¸€ì“°ê¸° ì§€ë„ ìë£Œ</span>
          <button class="copy-btn" onclick="copyResult('writing-content')">ë³µì‚¬</button>
        </div>
        <div class="result-content" id="writing-content"></div>
      </div>
    </div>

    <!-- â‘£ ìˆ˜í•™ í•™ìŠµ -->
    <div id="panel-math" class="panel">
      <div class="panel-header">
        <div class="panel-title">ìˆ˜í•™ <span class="accent-gold">í•™ìŠµ ë„ìš°ë¯¸</span></div>
        <div class="panel-desc">ë‹¨ì›ê³¼ í•™ìŠµ ëª©í‘œë¥¼ ì…ë ¥í•˜ë©´ ê°œë… ì„¤ëª…, ìœ í˜•ë³„ ë¬¸ì œ, í’€ì´ ê³¼ì •ì„ ë§Œë“¤ì–´ ë“œë¦½ë‹ˆë‹¤.</div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>í•™ë…„</label>
          <select id="mt-grade">
            <option value="">ì„ íƒ</option>
            <option>ì´ˆë“± 1í•™ë…„</option><option>ì´ˆë“± 2í•™ë…„</option><option>ì´ˆë“± 3í•™ë…„</option>
            <option>ì´ˆë“± 4í•™ë…„</option><option>ì´ˆë“± 5í•™ë…„</option><option>ì´ˆë“± 6í•™ë…„</option>
            <option>ì¤‘í•™êµ 1í•™ë…„</option><option>ì¤‘í•™êµ 2í•™ë…„</option><option>ì¤‘í•™êµ 3í•™ë…„</option>
            <option>ê³ ë“±í•™êµ 1í•™ë…„</option><option>ê³ ë“±í•™êµ 2í•™ë…„</option>
          </select>
        </div>
        <div class="form-group">
          <label>ë‹¨ì› / ê°œë…</label>
          <input type="text" id="mt-topic" placeholder="ì˜ˆ: ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ, ì´ì°¨ë°©ì •ì‹, í™•ë¥ ..." />
        </div>
      </div>
      <div class="form-group">
        <label>í•™ìŠµ ìˆ˜ì¤€</label>
        <div class="chip-group" id="math-level-chips">
          <div class="chip" onclick="selectOne(this,'math-level-chips')">ê¸°ì´ˆ (ë³´ì¶©)</div>
          <div class="chip selected" onclick="selectOne(this,'math-level-chips')">ê¸°ë³¸</div>
          <div class="chip" onclick="selectOne(this,'math-level-chips')">ì‹¬í™”</div>
          <div class="chip" onclick="selectOne(this,'math-level-chips')">í˜¼í•© (ê¸°ë³¸+ì‹¬í™”)</div>
        </div>
      </div>
      <div class="form-group">
        <label>ìƒì„±í•  ìë£Œ</label>
        <div class="chip-group" id="math-chips">
          <div class="chip selected" onclick="toggleChip(this)">ê°œë… í•µì‹¬ ì •ë¦¬</div>
          <div class="chip selected" onclick="toggleChip(this)">ìœ í˜•ë³„ ì˜ˆì œ ë¬¸ì œ</div>
          <div class="chip" onclick="toggleChip(this)">ë‹¨ê³„ë³„ í’€ì´ ê³¼ì •</div>
          <div class="chip" onclick="toggleChip(this)">ì—°ìŠµ ë¬¸ì œ 10ê°œ</div>
          <div class="chip" onclick="toggleChip(this)">ìì£¼ í‹€ë¦¬ëŠ” ì˜¤ë¥˜ ìœ í˜•</div>
          <div class="chip" onclick="toggleChip(this)">ì‹¤ìƒí™œ ì ìš© ë¬¸ì œ</div>
        </div>
      </div>
      <div class="form-group">
        <label>íŠ¹ë³„ ìš”ì²­ (ì„ íƒ)</label>
        <textarea id="mt-note" placeholder="ì˜ˆ: ì‹œê°ì  ì„¤ëª… ê°•ì¡°, íŠ¹ì • ìœ í˜• ì§‘ì¤‘, ì„œìˆ í˜• ìœ„ì£¼..." style="min-height:70px"></textarea>
      </div>
      <button class="btn-primary gold" onclick="runMath()">ğŸ”¢ ìˆ˜í•™ ìë£Œ ìƒì„±</button>
      <div class="result-box" id="math-result" style="display:none">
        <div class="result-header">
          <span class="result-title" style="color:var(--gold)">ìˆ˜í•™ í•™ìŠµ ìë£Œ</span>
          <button class="copy-btn" style="color:var(--gold);border-color:rgba(246,216,96,0.3);background:rgba(246,216,96,0.08)" onclick="copyResult('math-content')">ë³µì‚¬</button>
        </div>
        <div class="result-content" id="math-content"></div>
      </div>
    </div>

    <!-- â‘¤ í•™ìƒ ìƒë‹´ ê´€ë¦¬ -->
    <div id="panel-counsel" class="panel">
      <div class="panel-header">
        <div class="panel-title">í•™ìƒ <span class="accent-green">ìƒë‹´ ê´€ë¦¬</span></div>
        <div class="panel-desc">í•™ìƒ ì •ë³´ì™€ ìƒë‹´ ê¸°ë¡ì„ ì €ì¥í•˜ê³ , AIë¡œ í•™ë¶€ëª¨ ìƒë‹´ ìë£Œë¥¼ ìë™ ìƒì„±í•©ë‹ˆë‹¤.</div>
      </div>
      <div class="counsel-layout">
        <div class="student-sidebar">
          <div class="sidebar-header">
            <span class="sidebar-title">í•™ìƒ ëª©ë¡</span>
            <button class="btn-add-student" onclick="openAddStudent()" title="í•™ìƒ ì¶”ê°€">+</button>
          </div>
          <div class="student-search-wrap">
            <input type="text" id="student-search-input" placeholder="ì´ë¦„ ê²€ìƒ‰..." oninput="filterStudents()" />
          </div>
          <div class="student-list" id="student-list">
            <div class="empty-state"><div class="ei">ğŸ‘¤</div><p>+ ë²„íŠ¼ìœ¼ë¡œ<br>í•™ìƒì„ ì¶”ê°€í•˜ì„¸ìš”</p></div>
          </div>
        </div>
        <div class="counsel-detail" id="counsel-detail">
          <div class="empty-state" style="margin:auto;padding:80px 20px">
            <div class="ei">ğŸ«‚</div><p>í•™ìƒì„ ì„ íƒí•˜ê±°ë‚˜<br>ìƒˆ í•™ìƒì„ ì¶”ê°€í•˜ì„¸ìš”</p>
          </div>
        </div>
      </div>
    </div>

    <!-- â‘¥ ì±„ì Â·í”¼ë“œë°± -->
    <div id="panel-grade" class="panel">
      <div class="panel-header">
        <div class="panel-title">ì±„ì  Â· <span class="accent">í”¼ë“œë°± ë³´ì¡°</span></div>
        <div class="panel-desc">í•™ìƒ ë‹µì•ˆì„ ë¶™ì—¬ë„£ìœ¼ë©´ ë£¨ë¸Œë¦­ ê¸°ë°˜ í”¼ë“œë°±ì„ ìë™ìœ¼ë¡œ ì‘ì„±í•´ ë“œë¦½ë‹ˆë‹¤.</div>
      </div>
      <div class="form-group">
        <label>í‰ê°€ ê¸°ì¤€ / ë£¨ë¸Œë¦­ (ì„ íƒ)</label>
        <input type="text" id="g-rubric" placeholder="ì˜ˆ: ì°½ì˜ì„±, ë…¼ë¦¬ì„±, ë§ì¶¤ë²• â€” ì—†ìœ¼ë©´ AIê°€ ì ì ˆíˆ íŒë‹¨í•©ë‹ˆë‹¤" />
      </div>
      <div class="form-group">
        <label>í•™ìƒ ë‹µì•ˆ / ê¸€</label>
        <textarea id="g-student" placeholder="í•™ìƒì´ ì‘ì„±í•œ ë‚´ìš©ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
      </div>
      <div class="form-group">
        <label>í”¼ë“œë°± í†¤</label>
        <div class="chip-group" id="tone-chips">
          <div class="chip selected" onclick="selectOne(this,'tone-chips')">ë”°ëœ»í•˜ê³  ê²©ë ¤ì </div>
          <div class="chip" onclick="selectOne(this,'tone-chips')">ê°ê´€ì Â·êµ¬ì²´ì </div>
          <div class="chip" onclick="selectOne(this,'tone-chips')">ê°„ê²°Â·ì§ì ‘ì </div>
        </div>
      </div>
      <button class="btn-primary" onclick="runGrade()">ğŸ“ í”¼ë“œë°± ìƒì„±</button>
      <div class="result-box" id="grade-result" style="display:none">
        <div class="result-header">
          <span class="result-title">í”¼ë“œë°± ê²°ê³¼</span>
          <button class="copy-btn" onclick="copyResult('grade-content')">ë³µì‚¬</button>
        </div>
        <div class="result-content" id="grade-content"></div>
      </div>
    </div>

  </main>
</div>

<!-- í•™ìƒ ì¶”ê°€/í¸ì§‘ ëª¨ë‹¬ -->
<div class="modal-overlay" id="modal-student" style="display:none" onclick="closeModalOverlay(event,'modal-student')">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title" id="modal-student-title">í•™ìƒ ì¶”ê°€</span>
      <button class="modal-close" onclick="closeModal('modal-student')">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group"><label>ì´ë¦„ *</label><input type="text" id="s-name" placeholder="í™ê¸¸ë™" /></div>
        <div class="form-group"><label>í•™ë²ˆ/ë²ˆí˜¸</label><input type="text" id="s-number" placeholder="3-2 / 15ë²ˆ" /></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>í•™ë…„/ë°˜</label><input type="text" id="s-class" placeholder="3í•™ë…„ 2ë°˜" /></div>
        <div class="form-group"><label>ë³´í˜¸ì ì—°ë½ì²˜</label><input type="text" id="s-parent-tel" placeholder="010-0000-0000" /></div>
      </div>
      <div class="form-group"><label>ê°•ì /ê´€ì‹¬ì‚¬</label><input type="text" id="s-strength" placeholder="ìˆ˜í•™ ìš°ìˆ˜, ë¯¸ìˆ  ì¢‹ì•„í•¨..." /></div>
      <div class="form-group"><label>ì£¼ì˜ ê´€ì°° ì‚¬í•­</label><input type="text" id="s-concern" placeholder="ì£¼ì˜ë ¥ ë¶€ì¡±, êµìš°ê´€ê³„ ì–´ë ¤ì›€..." /></div>
      <div class="form-group"><label>ê¸°ë³¸ ë©”ëª¨</label><textarea id="s-memo" placeholder="í•™ìŠµ íŠ¹ì„±, ì„±ê²©, ê¸°íƒ€ ë©”ëª¨..." style="min-height:80px"></textarea></div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeModal('modal-student')">ì·¨ì†Œ</button>
      <button class="btn-primary" onclick="saveStudent()">ğŸ’¾ ì €ì¥</button>
    </div>
  </div>
</div>

<!-- ìƒë‹´ ê¸°ë¡ ì¶”ê°€ ëª¨ë‹¬ -->
<div class="modal-overlay" id="modal-record" style="display:none" onclick="closeModalOverlay(event,'modal-record')">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title">ìƒë‹´ ê¸°ë¡ ì¶”ê°€</span>
      <button class="modal-close" onclick="closeModal('modal-record')">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group"><label>ë‚ ì§œ</label><input type="date" id="r-date" /></div>
        <div class="form-group"><label>ìƒë‹´ ìœ í˜•</label>
          <select id="r-type">
            <option value="student">í•™ìƒ ìƒë‹´</option>
            <option value="parent">í•™ë¶€ëª¨ ìƒë‹´</option>
            <option value="phone">ì „í™” ìƒë‹´</option>
            <option value="etc">ê¸°íƒ€</option>
          </select>
        </div>
      </div>
      <div class="form-group"><label>ìƒë‹´ ì£¼ì œ</label><input type="text" id="r-topic" placeholder="í•™ìŠµ ë¶€ì§„, êµìš°ê´€ê³„, ì§„ë¡œ ê³ ë¯¼..." /></div>
      <div class="form-group"><label>ìƒë‹´ ë‚´ìš©</label><textarea id="r-content" placeholder="ìƒë‹´ ë‚´ìš©, í•™ìƒ/í•™ë¶€ëª¨ ë°˜ì‘, íŠ¹ì´ì‚¬í•­..." style="min-height:120px"></textarea></div>
      <div class="form-group"><label>í›„ì† ì¡°ì¹˜</label><textarea id="r-followup" placeholder="ë‹¤ìŒ ìƒë‹´ ì¼ì •, ì¡°ì¹˜ ì‚¬í•­..." style="min-height:70px"></textarea></div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeModal('modal-record')">ì·¨ì†Œ</button>
      <button class="btn-primary" onclick="saveRecord()">ğŸ’¾ ê¸°ë¡ ì €ì¥</button>
    </div>
  </div>
</div>

<script>
let apiKey = '';

// API í‚¤ ê´€ë¦¬
function saveKey() {
  apiKey = document.getElementById('apiKey').value.trim();
  if (apiKey) {
    localStorage.setItem('teacher-api-key', apiKey);
    updateApiStatus();
    alert('âœ… API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
  }
}

function deleteKey() {
  if (!confirm('ì €ì¥ëœ API í‚¤ë¥¼ ì‚­ì œí• ê¹Œìš”?')) return;
  localStorage.removeItem('teacher-api-key');
  apiKey = '';
  document.getElementById('apiKey').value = '';
  updateApiStatus();
}

function updateApiStatus() {
  const el = document.getElementById('api-status');
  if (apiKey) {
    el.textContent = 'â— ì„¤ì •ë¨';
    el.className = 'api-status ok';
  } else {
    el.textContent = 'â— ë¯¸ì„¤ì •';
    el.className = 'api-status no';
  }
}

// ì €ì¥ëœ í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°
const _saved = localStorage.getItem('teacher-api-key');
if (_saved) {
  apiKey = _saved;
  document.getElementById('apiKey').value = _saved;
}
updateApiStatus();

// íŒ¨ë„ ì „í™˜
function showPanel(name, el) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  el.classList.add('active');
}

// ì¹© ì„ íƒ
function toggleChip(el) { el.classList.toggle('selected'); }
function selectOne(el, groupId) {
  document.querySelectorAll('#' + groupId + ' .chip').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
}
function getSelectedChips(groupId) {
  return Array.from(document.querySelectorAll('#' + groupId + ' .chip.selected')).map(c => c.textContent.trim());
}

// Claude API í˜¸ì¶œ
async function callClaude(system, user, resultEl, boxEl) {
  if (!apiKey) { alert('API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
  boxEl.style.display = 'block';
  resultEl.innerHTML = `<div class="loading-wrap"><div class="loading-dots"><span></span><span></span><span></span></div><div class="loading-label">AIê°€ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</div></div>`;
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': apiKey,
        'anthropic-version': '2023-06-01',
        'anthropic-dangerous-direct-browser-access': 'true'
      },
      body: JSON.stringify({ model: 'claude-opus-4-6', max_tokens: 2000, system, messages: [{ role: 'user', content: user }] })
    });
    if (!res.ok) { const e = await res.json(); throw new Error(e.error?.message || 'ì˜¤ë¥˜'); }
    const data = await res.json();
    resultEl.textContent = data.content[0].text;
  } catch(e) {
    resultEl.textContent = 'âŒ ì˜¤ë¥˜: ' + e.message + '\n\nAPI í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
  }
}

function copyResult(id) {
  navigator.clipboard.writeText(document.getElementById(id).textContent).then(() => {
    event.target.textContent = 'ë³µì‚¬ë¨ âœ“';
    setTimeout(() => event.target.textContent = 'ë³µì‚¬', 2000);
  });
}

// â‘  ìˆ˜ì—… ìë£Œ
function runLesson() {
  const subject = document.getElementById('l-subject').value;
  const grade = document.getElementById('l-grade').value;
  const topic = document.getElementById('l-topic').value;
  const materials = getSelectedChips('material-chips');
  if (!topic) { alert('ë‹¨ì›/ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
  callClaude(
    `ë‹¹ì‹ ì€ í•œêµ­ì˜ ìˆ™ë ¨ëœ êµì‚¬ë¥¼ ë•ëŠ” êµìœ¡ ì „ë¬¸ AIì…ë‹ˆë‹¤. ì‹¤ì œ ìˆ˜ì—…ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì‹¤ìš©ì ì´ê³  ì™„ì„±ë„ ë†’ì€ êµìœ¡ ìë£Œë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”. í•œêµ­ êµìœ¡ê³¼ì •ì— ë§ê²Œ ì‘ì„±í•˜ì„¸ìš”.`,
    `ê³¼ëª©: ${subject||'ë¯¸ì§€ì •'}\ní•™ë…„: ${grade||'ë¯¸ì§€ì •'}\në‹¨ì›/ì£¼ì œ: ${topic}\nìƒì„±í•  ìë£Œ: ${materials.join(', ')}\n\nê° ìë£Œ ì¢…ë¥˜ë¥¼ êµ¬ë¶„í•´ì„œ ì‘ì„±í•´ ì£¼ì„¸ìš”.`,
    document.getElementById('lesson-content'), document.getElementById('lesson-result')
  );
}

// â‘¡ ë…ì„œ ì§€ë„
function runReading() {
  const title = document.getElementById('rd-title').value;
  const author = document.getElementById('rd-author').value;
  const grade = document.getElementById('rd-grade').value;
  const purpose = document.getElementById('rd-purpose').value;
  const materials = getSelectedChips('reading-chips');
  const memo = document.getElementById('rd-memo').value;
  if (!title) { alert('ì±… ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
  callClaude(
    `ë‹¹ì‹ ì€ í•œêµ­ì˜ ë…ì„œ êµìœ¡ ì „ë¬¸ êµì‚¬ì…ë‹ˆë‹¤. í•™ìƒë“¤ì˜ ë…ì„œ í¥ë¯¸ì™€ ì´í•´ë ¥ì„ ë†’ì´ëŠ” ì‹¤ìš©ì ì¸ ë…ì„œ ì§€ë„ ìë£Œë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”. í•™ë…„ ìˆ˜ì¤€ì— ë§ëŠ” ì–´íœ˜ì™€ ì‚¬ê³  ìˆ˜ì¤€ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.`,
    `ì±… ì œëª©: ${title}${author ? '\nì €ì: ' + author : ''}\nëŒ€ìƒ í•™ë…„: ${grade||'ë¯¸ì§€ì •'}\nëª©ì : ${purpose}\nìƒì„±í•  ìë£Œ: ${materials.join(', ')}${memo ? '\nì¶”ê°€ ìš”ì²­: ' + memo : ''}\n\nê° ìë£Œë¥¼ ì¶©ì‹¤í•˜ê²Œ ì‘ì„±í•´ ì£¼ì„¸ìš”.`,
    document.getElementById('reading-content'), document.getElementById('reading-result')
  );
}

// â‘¢ ê¸€ì“°ê¸° ì§€ë„
function runWriting() {
  const type = document.getElementById('wr-type').value;
  const grade = document.getElementById('wr-grade').value;
  const topic = document.getElementById('wr-topic').value;
  const materials = getSelectedChips('writing-chips');
  const studentText = document.getElementById('wr-student-text').value;
  if (!topic) { alert('ê¸€ì“°ê¸° ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
  const studentPart = studentText ? `\n\n[ì²¨ì‚­ ìš”ì²­ í•™ìƒ ê¸€]\n${studentText}\nìœ„ ê¸€ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ì²¨ì‚­ í”¼ë“œë°±ë„ í•¨ê»˜ ì œê³µí•´ì£¼ì„¸ìš”.` : '';
  callClaude(
    `ë‹¹ì‹ ì€ í•œêµ­ì–´ ê¸€ì“°ê¸° êµìœ¡ ì „ë¬¸ êµì‚¬ì…ë‹ˆë‹¤. í•™ìƒë“¤ì´ ê¸€ì“°ê¸° ì‹¤ë ¥ì„ í‚¤ìš¸ ìˆ˜ ìˆë„ë¡ ì‹¤ìš©ì ì´ê³  êµ¬ì²´ì ì¸ ì§€ë„ ìë£Œë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.`,
    `ê¸€ì“°ê¸° ìœ í˜•: ${type}\nëŒ€ìƒ í•™ë…„: ${grade||'ë¯¸ì§€ì •'}\nì£¼ì œ/ì†Œì¬: ${topic}\nìƒì„±í•  ìë£Œ: ${materials.join(', ')}${studentPart}`,
    document.getElementById('writing-content'), document.getElementById('writing-result')
  );
}

// â‘£ ìˆ˜í•™ í•™ìŠµ
function runMath() {
  const grade = document.getElementById('mt-grade').value;
  const topic = document.getElementById('mt-topic').value;
  const level = getSelectedChips('math-level-chips')[0] || 'ê¸°ë³¸';
  const materials = getSelectedChips('math-chips');
  const note = document.getElementById('mt-note').value;
  if (!topic) { alert('ë‹¨ì›/ê°œë…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
  callClaude(
    `ë‹¹ì‹ ì€ í•œêµ­ì˜ ìˆ˜í•™ êµìœ¡ ì „ë¬¸ êµì‚¬ì…ë‹ˆë‹¤. í•™ìƒë“¤ì´ ê°œë…ì„ ëª…í™•íˆ ì´í•´í•˜ê³  ë¬¸ì œ í’€ì´ ëŠ¥ë ¥ì„ í‚¤ìš¸ ìˆ˜ ìˆëŠ” ìˆ˜í•™ í•™ìŠµ ìë£Œë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”. í’€ì´ ê³¼ì •ì€ ë‹¨ê³„ë³„ë¡œ ëª…í™•í•˜ê²Œ ì„¤ëª…í•˜ì„¸ìš”.`,
    `í•™ë…„: ${grade||'ë¯¸ì§€ì •'}\në‹¨ì›/ê°œë…: ${topic}\ní•™ìŠµ ìˆ˜ì¤€: ${level}\nìƒì„±í•  ìë£Œ: ${materials.join(', ')}${note ? '\níŠ¹ë³„ ìš”ì²­: ' + note : ''}\n\nìˆ˜ì‹ì€ ë³´ê¸° ì‰½ê²Œ í‘œí˜„í•´ ì£¼ì„¸ìš”.`,
    document.getElementById('math-content'), document.getElementById('math-result')
  );
}

// â‘¥ ì±„ì /í”¼ë“œë°±
function runGrade() {
  const rubric = document.getElementById('g-rubric').value;
  const student = document.getElementById('g-student').value;
  const tone = getSelectedChips('tone-chips')[0] || 'ë”°ëœ»í•˜ê³  ê²©ë ¤ì ';
  if (!student) { alert('í•™ìƒ ë‹µì•ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
  callClaude(
    `ë‹¹ì‹ ì€ í•œêµ­ êµì‚¬ë¥¼ ë•ëŠ” êµìœ¡ í‰ê°€ ì „ë¬¸ AIì…ë‹ˆë‹¤. í•™ìƒì˜ ì„±ì¥ì„ ë•ëŠ” ê±´ì„¤ì ì´ê³  êµ¬ì²´ì ì¸ í”¼ë“œë°±ì„ ì‘ì„±í•©ë‹ˆë‹¤.\ní”¼ë“œë°± í†¤: ${tone}\ní˜•ì‹: ì˜í•œ ì  â†’ ê°œì„ í•  ì  â†’ ì¢…í•© í‰ê°€`,
    `${rubric ? 'í‰ê°€ ê¸°ì¤€: ' + rubric + '\n' : ''}í•™ìƒ ë‹µì•ˆ:\n${student}`,
    document.getElementById('grade-content'), document.getElementById('grade-result')
  );
}

/* ========== í•™ìƒ ìƒë‹´ ì‹œìŠ¤í…œ ========== */
let students = {};
let counselRecords = {};
let currentStudentId = null;
let editingStudentId = null;

async function loadCounselData() {
  try { const r = await window.storage.get('teacher-students'); if (r) students = JSON.parse(r.value); } catch(e) { students = {}; }
  try { const r = await window.storage.get('teacher-records'); if (r) counselRecords = JSON.parse(r.value); } catch(e) { counselRecords = {}; }
  renderStudentList();
}

async function saveStudentsToStorage() { try { await window.storage.set('teacher-students', JSON.stringify(students)); } catch(e) {} }
async function saveRecordsToStorage() { try { await window.storage.set('teacher-records', JSON.stringify(counselRecords)); } catch(e) {} }
function genId() { return Date.now().toString(36) + Math.random().toString(36).slice(2,6); }

function renderStudentList(filter='') {
  const list = document.getElementById('student-list');
  const ids = Object.keys(students).filter(id => !filter || students[id].name.includes(filter));
  if (ids.length === 0) { list.innerHTML = `<div class="empty-state"><div class="ei">ğŸ‘¤</div><p>+ ë²„íŠ¼ìœ¼ë¡œ<br>í•™ìƒì„ ì¶”ê°€í•˜ì„¸ìš”</p></div>`; return; }
  list.innerHTML = ids.map(id => {
    const s = students[id];
    const cnt = (counselRecords[id] || []).length;
    return `<div class="student-card ${id===currentStudentId?'active':''}" onclick="selectStudent('${id}')">
      <div class="student-card-name">${s.name}${cnt>0?`<span class="student-badge">${cnt}ê±´</span>`:''}</div>
      <div class="student-card-meta">${s.sClass||''}${s.number?' Â· '+s.number:''}</div>
    </div>`;
  }).join('');
}

function filterStudents() { renderStudentList(document.getElementById('student-search-input').value.trim()); }

function selectStudent(id) {
  currentStudentId = id;
  renderStudentList(document.getElementById('student-search-input').value.trim());
  renderCounselDetail();
}

function renderCounselDetail() {
  const detail = document.getElementById('counsel-detail');
  if (!currentStudentId || !students[currentStudentId]) {
    detail.innerHTML = `<div class="empty-state" style="margin:auto;padding:80px 20px"><div class="ei">ğŸ«‚</div><p>í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”</p></div>`;
    return;
  }
  const s = students[currentStudentId];
  const records = counselRecords[currentStudentId] || [];
  detail.innerHTML = `
    <div class="detail-card">
      <div class="detail-card-header">
        <span class="detail-card-title">ğŸ‘¤ ${s.name} í•™ìƒ ì •ë³´</span>
        <div style="display:flex;gap:8px">
          <button class="btn-secondary" style="padding:5px 12px;font-size:0.75rem" onclick="openEditStudent('${currentStudentId}')">âœï¸ í¸ì§‘</button>
          <button class="btn-secondary" style="padding:5px 12px;font-size:0.75rem;color:var(--red);border-color:rgba(252,129,129,0.3)" onclick="deleteStudent('${currentStudentId}')">ì‚­ì œ</button>
        </div>
      </div>
      <div class="detail-card-body">
        <div class="form-row-3" style="gap:10px;margin-bottom:0">
          <div><div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;margin-bottom:4px">í•™ë…„/ë°˜</div><div style="font-size:0.88rem">${s.sClass||'-'}</div></div>
          <div><div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;margin-bottom:4px">ë²ˆí˜¸</div><div style="font-size:0.88rem">${s.number||'-'}</div></div>
          <div><div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;margin-bottom:4px">ë³´í˜¸ì ì—°ë½ì²˜</div><div style="font-size:0.88rem">${s.parentTel||'-'}</div></div>
        </div>
        ${s.strength?`<div style="margin-top:12px"><div style="font-size:0.72rem;color:var(--accent);font-weight:600;margin-bottom:4px">âœ… ê°•ì /ê´€ì‹¬ì‚¬</div><div style="font-size:0.85rem;line-height:1.6">${s.strength}</div></div>`:''}
        ${s.concern?`<div style="margin-top:10px"><div style="font-size:0.72rem;color:var(--red);font-weight:600;margin-bottom:4px">âš ï¸ ì£¼ì˜ ê´€ì°°</div><div style="font-size:0.85rem;line-height:1.6">${s.concern}</div></div>`:''}
        ${s.memo?`<div style="margin-top:10px"><div style="font-size:0.72rem;color:var(--text-muted);margin-bottom:4px">ğŸ“ ë©”ëª¨</div><div style="font-size:0.85rem;line-height:1.7;white-space:pre-wrap">${s.memo}</div></div>`:''}
      </div>
    </div>
    <div class="detail-card">
      <div class="detail-card-header">
        <span class="detail-card-title">ğŸ“‹ ìƒë‹´ ê¸°ë¡ (${records.length}ê±´)</span>
        <button class="btn-secondary" style="padding:5px 12px;font-size:0.75rem" onclick="openAddRecord()">+ ê¸°ë¡ ì¶”ê°€</button>
      </div>
      <div class="detail-card-body">
        ${records.length===0
          ? `<div class="empty-state" style="padding:24px"><div class="ei" style="font-size:1.6rem">ğŸ“</div><p>ì•„ì§ ìƒë‹´ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p></div>`
          : `<div class="record-list">${records.slice().reverse().map(r=>`
            <div class="record-item">
              <button class="record-delete" onclick="deleteRecord('${currentStudentId}','${r.id}')">Ã—</button>
              <div class="record-item-date">${r.date||'ë‚ ì§œ ë¯¸ì§€ì •'}<span class="record-type-badge ${r.type==='parent'?'badge-parent':'badge-student'}">${getTypeLabel(r.type)}</span>${r.topic?`<span style="font-size:0.72rem;color:var(--text-dim)">Â· ${r.topic}</span>`:''}</div>
              <div class="record-item-content">${r.content||''}</div>
              ${r.followup?`<div style="margin-top:8px;padding:7px 10px;background:rgba(104,211,145,0.06);border:1px solid rgba(104,211,145,0.15);border-radius:6px;font-size:0.8rem;color:var(--accent);line-height:1.6">â†’ ${r.followup}</div>`:''}
            </div>`).join('')}</div>`
        }
      </div>
    </div>
    <div class="detail-card">
      <div class="detail-card-header"><span class="detail-card-title">ğŸ¤– AI í•™ë¶€ëª¨ ìƒë‹´ ìë£Œ ìƒì„±</span></div>
      <div class="detail-card-body">
        <div class="form-group"><label>ì´ë²ˆ ìƒë‹´ ì•ˆê±´</label><textarea id="parent-agenda" placeholder="í•™ìŠµ ë¶€ì§„ ì›ì¸ íŒŒì•…, ìƒí™œ íƒœë„ ê°œì„ , ê¸ì •ì  ë³€í™” ê³µìœ ..." style="min-height:70px"></textarea></div>
        <div class="form-group"><label>ìƒë‹´ ë°©ì‹</label>
          <div class="chip-group" id="parent-mode-chips">
            <div class="chip selected" onclick="selectOne(this,'parent-mode-chips')">ëŒ€ë©´ ìƒë‹´</div>
            <div class="chip" onclick="selectOne(this,'parent-mode-chips')">ì „í™” ìƒë‹´</div>
            <div class="chip" onclick="selectOne(this,'parent-mode-chips')">ê°€ì •í†µì‹ ë¬¸</div>
          </div>
        </div>
        <div class="form-group" style="margin-bottom:0"><label>í¬í•¨í•  ë‚´ìš©</label>
          <div class="chip-group" id="parent-include-chips">
            <div class="chip selected" onclick="toggleChip(this)">í•™ìƒ í˜„í™© ìš”ì•½</div>
            <div class="chip selected" onclick="toggleChip(this)">ìƒë‹´ ê¸°ë¡ ë°˜ì˜</div>
            <div class="chip" onclick="toggleChip(this)">ê°€ì • í˜‘ì¡° ìš”ì²­</div>
            <div class="chip" onclick="toggleChip(this)">ì•ìœ¼ë¡œì˜ ì§€ì› ê³„íš</div>
            <div class="chip" onclick="toggleChip(this)">ê¸ì •ì  ë³€í™” ê°•ì¡°</div>
          </div>
        </div>
        <button class="btn-primary green" style="margin-top:18px" onclick="runParentCounsel()">âœ¨ í•™ë¶€ëª¨ ìƒë‹´ ìë£Œ ìƒì„±</button>
        <div id="parent-result-box" style="display:none;margin-top:16px">
          <div class="result-box" style="margin-top:0">
            <div class="result-header">
              <span class="result-title" style="color:var(--accent)">í•™ë¶€ëª¨ ìƒë‹´ ìë£Œ</span>
              <button class="copy-btn" style="color:var(--accent);border-color:rgba(104,211,145,0.3);background:rgba(104,211,145,0.1)" onclick="copyResult('parent-result-content')">ë³µì‚¬</button>
            </div>
            <div class="result-content" id="parent-result-content"></div>
          </div>
        </div>
      </div>
    </div>`;
}

function getTypeLabel(t) { return {student:'í•™ìƒ ìƒë‹´',parent:'í•™ë¶€ëª¨ ìƒë‹´',phone:'ì „í™” ìƒë‹´',etc:'ê¸°íƒ€'}[t]||t; }

function openAddStudent() {
  editingStudentId = null;
  document.getElementById('modal-student-title').textContent = 'í•™ìƒ ì¶”ê°€';
  ['s-name','s-number','s-class','s-parent-tel','s-memo','s-strength','s-concern'].forEach(id => document.getElementById(id).value='');
  document.getElementById('modal-student').style.display='flex';
}

function openEditStudent(id) {
  editingStudentId = id;
  const s = students[id];
  document.getElementById('modal-student-title').textContent = 'í•™ìƒ ì •ë³´ í¸ì§‘';
  document.getElementById('s-name').value = s.name||'';
  document.getElementById('s-number').value = s.number||'';
  document.getElementById('s-class').value = s.sClass||'';
  document.getElementById('s-parent-tel').value = s.parentTel||'';
  document.getElementById('s-memo').value = s.memo||'';
  document.getElementById('s-strength').value = s.strength||'';
  document.getElementById('s-concern').value = s.concern||'';
  document.getElementById('modal-student').style.display='flex';
}

function openAddRecord() {
  document.getElementById('r-date').value = new Date().toISOString().slice(0,10);
  document.getElementById('r-type').value = 'student';
  ['r-topic','r-content','r-followup'].forEach(id => document.getElementById(id).value='');
  document.getElementById('modal-record').style.display='flex';
}

function closeModal(id) { document.getElementById(id).style.display='none'; }
function closeModalOverlay(e, id) { if(e.target===e.currentTarget) closeModal(id); }

async function saveStudent() {
  const name = document.getElementById('s-name').value.trim();
  if (!name) { alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
  const id = editingStudentId || genId();
  students[id] = {
    name,
    number: document.getElementById('s-number').value.trim(),
    sClass: document.getElementById('s-class').value.trim(),
    parentTel: document.getElementById('s-parent-tel').value.trim(),
    memo: document.getElementById('s-memo').value.trim(),
    strength: document.getElementById('s-strength').value.trim(),
    concern: document.getElementById('s-concern').value.trim(),
    createdAt: editingStudentId ? (students[editingStudentId]?.createdAt||Date.now()) : Date.now()
  };
  await saveStudentsToStorage();
  closeModal('modal-student');
  currentStudentId = id;
  renderStudentList();
  renderCounselDetail();
}

async function deleteStudent(id) {
  if (!confirm(`${students[id]?.name} í•™ìƒ ì •ë³´ë¥¼ ì‚­ì œí• ê¹Œìš”?`)) return;
  delete students[id]; delete counselRecords[id];
  if (currentStudentId===id) currentStudentId=null;
  await saveStudentsToStorage(); await saveRecordsToStorage();
  renderStudentList(); renderCounselDetail();
}

async function saveRecord() {
  if (!currentStudentId) return;
  const content = document.getElementById('r-content').value.trim();
  if (!content) { alert('ìƒë‹´ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
  if (!counselRecords[currentStudentId]) counselRecords[currentStudentId]=[];
  counselRecords[currentStudentId].push({
    id: genId(),
    date: document.getElementById('r-date').value,
    type: document.getElementById('r-type').value,
    topic: document.getElementById('r-topic').value.trim(),
    content,
    followup: document.getElementById('r-followup').value.trim()
  });
  await saveRecordsToStorage();
  closeModal('modal-record');
  renderStudentList(document.getElementById('student-search-input').value.trim());
  renderCounselDetail();
}

async function deleteRecord(studentId, recordId) {
  if (!confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?')) return;
  counselRecords[studentId] = (counselRecords[studentId]||[]).filter(r=>r.id!==recordId);
  await saveRecordsToStorage();
  renderStudentList(document.getElementById('student-search-input').value.trim());
  renderCounselDetail();
}

async function runParentCounsel() {
  if (!currentStudentId) return;
  if (!apiKey) { alert('API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
  const s = students[currentStudentId];
  const records = (counselRecords[currentStudentId]||[]);
  const agenda = document.getElementById('parent-agenda').value.trim();
  const mode = getSelectedChips('parent-mode-chips')[0]||'ëŒ€ë©´ ìƒë‹´';
  const includes = getSelectedChips('parent-include-chips');
  const resultBox = document.getElementById('parent-result-box');
  const resultEl = document.getElementById('parent-result-content');
  resultBox.style.display='block';
  resultEl.innerHTML=`<div class="loading-wrap"><div class="loading-dots"><span></span><span></span><span></span></div><div class="loading-label">í•™ë¶€ëª¨ ìƒë‹´ ìë£Œ ìƒì„± ì¤‘...</div></div>`;
  const recordSummary = records.length>0
    ? records.slice(-5).map(r=>`[${r.date}Â·${getTypeLabel(r.type)}] ${r.topic?r.topic+' â€” ':''}${r.content}${r.followup?'\nâ†’ '+r.followup:''}`).join('\n\n')
    : 'ì´ì „ ìƒë‹´ ê¸°ë¡ ì—†ìŒ';
  const prompt = `ë‹¹ì‹ ì€ í•œêµ­ì˜ ê²½í—˜ ë§ì€ ë‹´ì„êµì‚¬ì…ë‹ˆë‹¤. ë”°ëœ»í•˜ê³  ì „ë¬¸ì ì¸ ì–´ì¡°ë¡œ í•™ë¶€ëª¨ ìƒë‹´ ìë£Œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.\nìƒë‹´ ë°©ì‹: ${mode}\ní¬í•¨ ë‚´ìš©: ${includes.join(', ')}\n\ní•™ìƒ: ${s.name} (${s.sClass||''})\nê°•ì : ${s.strength||'ì—†ìŒ'}\nì£¼ì˜ì‚¬í•­: ${s.concern||'ì—†ìŒ'}\në©”ëª¨: ${s.memo||'ì—†ìŒ'}\n\nìµœê·¼ ìƒë‹´ ê¸°ë¡:\n${recordSummary}\n\nì´ë²ˆ ìƒë‹´ ì•ˆê±´: ${agenda||'ì „ë°˜ì  í˜„í™© ê³µìœ '}\n\nì‹¤ì œ ìƒë‹´ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì™„ì„±ëœ ìë£Œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.`;
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':apiKey,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
      body: JSON.stringify({
        model:'claude-opus-4-6', max_tokens:2000,
        system:`ë‹¹ì‹ ì€ í•œêµ­ì˜ ê²½í—˜ ë§ì€ ë‹´ì„êµì‚¬ì…ë‹ˆë‹¤. ë”°ëœ»í•˜ê³  ì „ë¬¸ì ì¸ ì–´ì¡°ë¡œ í•™ë¶€ëª¨ ìƒë‹´ ìë£Œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.\nìƒë‹´ ë°©ì‹: ${mode}\ní¬í•¨ ë‚´ìš©: ${includes.join(', ')}`,
        messages:[{role:'user',content:prompt}]
      })
    });
    const data = await res.json();
    resultEl.textContent = data.content[0].text;
  } catch(e) { resultEl.textContent = 'âŒ ì˜¤ë¥˜: ' + e.message; }
}

// ì´ˆê¸° ë°ì´í„° ë¡œë“œ
loadCounselData();
</script>
</body>
</html>
